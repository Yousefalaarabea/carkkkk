# Post-Trip Handover System

## ูุธุฑุฉ ุนุงูุฉ

ุชู ุชูููุฐ ูุธุงู **Post-Trip Handover** ูุฅุฏุงุฑุฉ ุนูููุฉ ุชุณููู ุงูุณูุงุฑุฉ ุจุนุฏ ุงูุชูุงุก ุงูุฑุญูุฉ ุจุฏูู ุณุงุฆู. ุงููุธุงู ูุชููู ูู ูุฑุญูุชูู ุฑุฆูุณูุชูู:

### 1. Renter Drop-Off (ุชุณููู ุงููุณุชุฃุฌุฑ)
### 2. Owner Drop-Off (ุงุณุชูุงู ุงููุงูู)

---

## ๐๏ธ ุงูุจููุฉ ุงููุนูุงุฑูุฉ

### **Models (ููุงุฐุฌ ุงูุจูุงูุงุช)**

#### `PostTripHandoverModel`
- ูุญุชูู ุนูู ูู ุจูุงูุงุช ุนูููุฉ ุงูุชุณููู
- ูุชุชุจุน ุญุงูุฉ ุงูุชุณููู ููู ูู ุงููุณุชุฃุฌุฑ ูุงููุงูู
- ูุญูุธ ูุนูููุงุช ุงูุฏูุน ูุงูุฑุณูู ุงูุฒุงุฆุฏุฉ

#### `ExcessChargesModel`
- ูุญุณุจ ุงูุฑุณูู ุงูุฒุงุฆุฏุฉ ููููุช ูุงููููููุชุฑุงุช
- ูุญุชูู ุนูู ุงูุฃุณุนุงุฑ ุงููุชูู ุนูููุง ูุงููุนูู

#### `HandoverLogModel`
- ูุณุฌู ูู ุฎุทูุฉ ูู ุนูููุฉ ุงูุชุณููู
- ูุชุชุจุน ุงูุฅุฌุฑุงุกุงุช ูุงูููุช ูุงูุชูุงุฑูุฎ

### **Cubits (ุฅุฏุงุฑุฉ ุงูุญุงูุฉ)**

#### `RenterDropOffCubit`
- ูุฏูุฑ ุนูููุฉ ุชุณููู ุงููุณุชุฃุฌุฑ
- ูุชุนุงูู ูุน ุฑูุน ุงูุตูุฑ ูุญุณุงุจ ุงูุฑุณูู ุงูุฒุงุฆุฏุฉ
- ูุนุงูุฌ ุงูุฏูุน ููุถูู ุงูููุงุญุธุงุช

#### `OwnerDropOffCubit`
- ูุฏูุฑ ุนูููุฉ ุงุณุชูุงู ุงููุงูู
- ูุนุฑุถ ุจูุงูุงุช ุชุณููู ุงููุณุชุฃุฌุฑ
- ูุคูุฏ ุงุณุชูุงู ุงูุฏูุน ุงูููุฏู ููุถูู ููุงุญุธุงุช ุงููุงูู

### **Screens (ุงูุดุงุดุงุช)**

#### `RenterDropOffScreen`
- ุดุงุดุฉ ุชุณููู ุงููุณุชุฃุฌุฑ ูุน 5 ุฎุทูุงุช:
  1. ุฑูุน ุตูุฑุฉ ุงูุณูุงุฑุฉ ุจุนุฏ ุงูุฑุญูุฉ
  2. ุฑูุน ุตูุฑุฉ ุนุฏุงุฏ ุงููุณุงูุงุช
  3. ุฅุฏุฎุงู ูุฑุงุกุฉ ุงูุนุฏุงุฏ ุงูููุงุฆูุฉ
  4. ุญุณุงุจ ุงูุฑุณูู ุงูุฒุงุฆุฏุฉ ููุนุงูุฌุฉ ุงูุฏูุน
  5. ุฅุถุงูุฉ ููุงุญุธุงุช ุงููุณุชุฃุฌุฑ

#### `OwnerDropOffScreen`
- ุดุงุดุฉ ุงุณุชูุงู ุงููุงูู ุชุนุฑุถ:
  - ููุฎุต ุนูููุฉ ุงูุชุณููู
  - ุงูุตูุฑ ุงููุฑููุนุฉ
  - ุงูุฑุณูู ุงูุฒุงุฆุฏุฉ
  - ุญุงูุฉ ุงูุฏูุน
  - ููุงุญุธุงุช ุงููุณุชุฃุฌุฑ
  - ุฅุถุงูุฉ ููุงุญุธุงุช ุงููุงูู

### **Widgets (ุงูุนูุงุตุฑ)**

#### `ExcessChargesWidget`
- ูุนุฑุถ ุชูุงุตูู ุงูุฑุณูู ุงูุฒุงุฆุฏุฉ
- ูุญุณุจ ุงูุชูููุฉ ุงูุฅุฌูุงููุฉ
- ูุนุฑุถ ุทุฑููุฉ ุงูุฏูุน ูุญุงูุชูุง

#### `HandoverNotesWidget`
- ูุณูุญ ุจุฅุถุงูุฉ ุงูููุงุญุธุงุช
- ูุนุฑุถ ุนุฏุฏ ุงูุฃุญุฑู ุงููุฏุฎูุฉ

#### `ImageUploadWidget`
- ูุชุนุงูู ูุน ุฑูุน ุงูุตูุฑ
- ูุฏุนู ุงููุงููุฑุง ูุงููุนุฑุถ

---

## ๐ Flow ุงูุนูููุฉ

### **ุงูุฎุทูุฉ 1: Renter Drop-Off**

1. **ุชููุฆุฉ ุงูุนูููุฉ**
   ```dart
   context.read<RenterDropOffCubit>().initializeHandover(
     tripId: 'trip_001',
     carId: 'car_001',
     renterId: 'renter_001',
     ownerId: 'owner_001',
     paymentMethod: 'visa',
   );
   ```

2. **ุฑูุน ุตูุฑุฉ ุงูุณูุงุฑุฉ**
   ```dart
   await context.read<RenterDropOffCubit>().uploadCarImage(imageFile);
   ```

3. **ุฑูุน ุตูุฑุฉ ุงูุนุฏุงุฏ**
   ```dart
   await context.read<RenterDropOffCubit>().uploadOdometerImage(imageFile);
   ```

4. **ุฅุฏุฎุงู ูุฑุงุกุฉ ุงูุนุฏุงุฏ**
   ```dart
   context.read<RenterDropOffCubit>().setFinalOdometerReading(250);
   ```

5. **ุญุณุงุจ ุงูุฑุณูู ุงูุฒุงุฆุฏุฉ**
   ```dart
   context.read<RenterDropOffCubit>().calculateExcessCharges(
     agreedKilometers: 200,
     agreedHours: 24,
     extraKmRate: 0.5,
     extraHourRate: 10.0,
   );
   ```

6. **ูุนุงูุฌุฉ ุงูุฏูุน**
   ```dart
   context.read<RenterDropOffCubit>().processPayment();
   ```

7. **ุฅุถุงูุฉ ุงูููุงุญุธุงุช**
   ```dart
   context.read<RenterDropOffCubit>().addRenterNotes('ููุงุญุธุงุช ุงููุณุชุฃุฌุฑ');
   ```

8. **ุฅููุงู ุงูุชุณููู**
   ```dart
   context.read<RenterDropOffCubit>().completeRenterHandover();
   ```

### **ุงูุฎุทูุฉ 2: Owner Drop-Off**

1. **ุชุญููู ุจูุงูุงุช ุงูุชุณููู**
   ```dart
   context.read<OwnerDropOffCubit>().loadHandoverData(handoverData, logs);
   ```

2. **ุชุฃููุฏ ุงูุฏูุน ุงูููุฏู (ุฅุฐุง ูุงู ูุทููุจุงู)**
   ```dart
   context.read<OwnerDropOffCubit>().confirmCashPayment();
   ```

3. **ุฅุถุงูุฉ ููุงุญุธุงุช ุงููุงูู**
   ```dart
   context.read<OwnerDropOffCubit>().addOwnerNotes('ููุงุญุธุงุช ุงููุงูู');
   ```

4. **ุฅููุงู ุงูุงุณุชูุงู**
   ```dart
   context.read<OwnerDropOffCubit>().completeOwnerHandover();
   ```

---

## ๐ ููููุฉ ุงูุงุณุชุฎุฏุงู

### **ุงูุจุฏุงูุฉ ูู ุดุงุดุฉ ุฅุฏุงุฑุฉ ุงูุฑุญูุฉ**

1. ุงูุชูู ุฅูู `TripManagementScreen`
2. ุงุถุบุท ุนูู ุฒุฑ `handshake` ูู ุงูู AppBar
3. ุณูุชู ูููู ุฅูู `RenterDropOffScreen`

### **ุงูุงูุชูุงู ุจูู ุงูุดุงุดุงุช**

```dart
// ูู ุดุงุดุฉ ุฅุฏุงุฑุฉ ุงูุฑุญูุฉ ุฅูู ุชุณููู ุงููุณุชุฃุฌุฑ
Navigator.pushNamed(
  context,
  ScreensName.renterDropOffScreen,
  arguments: {
    'tripId': 'trip_001',
    'carId': 'car_001',
    'renterId': 'renter_001',
    'ownerId': 'owner_001',
    'paymentMethod': 'visa',
  },
);

// ูู ุชุณููู ุงููุณุชุฃุฌุฑ ุฅูู ุงุณุชูุงู ุงููุงูู (ุชููุงุฆู)
// ูุญุฏุซ ูู RenterDropOffScreen ุนูุฏ ุฅููุงู ุงูุชุณููู

// ูู ุงุณุชูุงู ุงููุงูู ุฅูู ุงูุดุงุดุฉ ุงูุฑุฆูุณูุฉ (ุชููุงุฆู)
// ูุญุฏุซ ูู OwnerDropOffScreen ุนูุฏ ุฅููุงู ุงูุงุณุชูุงู
```

---

## ๐ ุชุชุจุน ุงูุจูุงูุงุช

### **Handover Logs**

ูู ุฎุทูุฉ ูุชู ุชุณุฌูููุง ูู `HandoverLogModel`:

```dart
HandoverLogModel.create(
  handoverId: 'handover_001',
  action: HandoverLogModel.renterUploadCarImage,
  actor: HandoverLogModel.renter,
  description: 'Car image uploaded',
  metadata: {'imagePath': '/path/to/image.jpg'},
);
```

### **ุงูุญุงูุงุช ุงููุฏุนููุฉ**

- `renter_upload_car_image`
- `renter_upload_odometer`
- `renter_payment`
- `renter_handover`
- `owner_review`
- `owner_handover`

---

## ๐ง ุงูุชุฎุตูุต

### **ุฅุถุงูุฉ ุทุฑู ุฏูุน ุฌุฏูุฏุฉ**

1. ุฃุถู ุงูุทุฑููุฉ ูู `PostTripHandoverModel.paymentMethod`
2. ุญุฏุซ `ExcessChargesWidget._getPaymentMethodText()`
3. ุฃุถู ููุทู ุงููุนุงูุฌุฉ ูู `RenterDropOffCubit.processPayment()`

### **ุชุฎุตูุต ุงูุฑุณูู ุงูุฒุงุฆุฏุฉ**

1. ุญุฏุซ `ExcessChargesModel.calculate()`
2. ุฃุถู ุญููู ุฌุฏูุฏุฉ ูู ุงููููุฐุฌ
3. ุญุฏุซ `ExcessChargesWidget` ูุนุฑุถ ุงูุญููู ุงูุฌุฏูุฏุฉ

### **ุฅุถุงูุฉ ุฎุทูุงุช ุฌุฏูุฏุฉ**

1. ุฃุถู ุงูุญุงูุฉ ูู ุงูู Cubit
2. ุฃุถู ุงูู State ุงูููุงุณุจ
3. ุญุฏุซ ุงูุดุงุดุฉ ูุนุฑุถ ุงูุฎุทูุฉ ุงูุฌุฏูุฏุฉ

---

## ๐งช ุงูุงุฎุชุจุงุฑ

### **ุงุฎุชุจุงุฑ Renter Drop-Off**

1. ุงุจุฏุฃ ูู `TripManagementScreen`
2. ุงุถุบุท ุนูู ุฒุฑ `handshake`
3. ุงุชุจุน ุงูุฎุทูุงุช ุงูุฎูุณ
4. ุชุฃูุฏ ูู ุฅููุงู ูู ุฎุทูุฉ

### **ุงุฎุชุจุงุฑ Owner Drop-Off**

1. ุจุนุฏ ุฅููุงู Renter Drop-Off
2. ุณุชูุชูู ุชููุงุฆูุงู ุฅูู Owner Drop-Off
3. ุฑุงุฌุน ุงูุจูุงูุงุช ุงููุนุฑูุถุฉ
4. ุฃููู ุนูููุฉ ุงูุงุณุชูุงู

---

## ๐ ููุงุญุธุงุช ูููุฉ

1. **ุงูุจูุงูุงุช ุงููุญุงููุฉ**: ุงููุธุงู ูุณุชุฎุฏู ุจูุงูุงุช ูุญุงููุฉ ููุงุฎุชุจุงุฑ
2. **ุงูุชุฎุฒูู ุงููุญูู**: ุงูุจูุงูุงุช ุชูุญูุธ ูุญููุงู ุญุงููุงู
3. **ุงูุชูุงูู ุงููุณุชูุจูู**: ุฌุงูุฒ ููุชูุงูู ูุน API
4. **ุงูุชุญูู**: ูู ุฎุทูุฉ ุชุชุทูุจ ุฅููุงู ุงูุฎุทูุฉ ุงูุณุงุจูุฉ
5. **ุงูุณุฌูุงุช**: ูู ุฅุฌุฑุงุก ููุณุฌู ูุน ุงูููุช ูุงูุชุงุฑูุฎ

---

## ๐ฎ ุงูุชุทููุฑ ุงููุณุชูุจูู

- [ ] ุชูุงูู ูุน API ุญูููู
- [ ] ุฅุดุนุงุฑุงุช push
- [ ] ุชุญููู ุงูุฃุฑุจุงุญ ูููุงูููู
- [ ] ุชูุงุฑูุฑ ููุตูุฉ
- [ ] ุฏุนู ุงููุฏููุนุงุช ุงูุฅููุชุฑูููุฉ
- [ ] ุชุชุจุน GPS ูู ุงูููุช ุงููุนูู 